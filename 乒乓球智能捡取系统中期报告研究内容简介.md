# 乒乓球智能捡取系统中期报告研究内容简介

## 一、选题背景

随着乒乓球运动的广泛普及，乒乓球训练和比赛后的捡球工作成为一项耗时且繁琐的任务。传统的捡球方式主要依靠人工完成，不仅效率低下，而且浪费宝贵的人力资源。尽管市场上已经出现了一些自动捡球设备，但这些设备普遍存在以下技术瓶颈：

1. **检测精度不足**：现有设备大多采用单一的视觉检测方式，在复杂环境（如光照变化、远距离检测、部分遮挡）下容易出现漏检或误检的情况。

2. **无法有效避障**：在实际应用场景中，捡球路径上常常存在各类障碍物（如椅子、水瓶等），现有设备缺乏有效的障碍物检测和避障能力，容易发生碰撞导致设备损坏或捡球失败。

3. **环境适应性差**：对不同光照条件、不同地面材质的适应性较差，难以在各种复杂环境下稳定工作，限制了系统的使用范围。

4. **智能化程度低**：缺乏对检测结果的智能分析和处理能力，不能根据实际情况进行动态调整，系统的自主性和鲁棒性有待提高。

针对上述问题，本项目旨在开发一种高精度、智能、适应性强的乒乓球智能捡取系统，以提高捡球效率，节省人力资源，并为乒乓球运动的普及和训练提供更好的技术支持。

## 二、研究内容

### 1. 双模式视觉检测系统

开发了基于本地检测与云端增强相结合的双模式视觉检测系统，具体研究内容包括：

- **本地YOLO检测**：使用优化的YOLO模型进行实时乒乓球检测，实现低延迟、高精度的近距离检测。研究了模型优化策略，针对乒乓球特点进行了模型训练和参数调优，确保在近距离场景下的检测精度超过95%。

- **云端视觉增强**：针对远距离检测精度不足的问题，设计并实现了云端视觉增强模块。当本地检测结果不满足预设条件时，自动调用云端大模型进行二次检测，解决远距离（>2米）乒乓球检测的技术难题。

- **智能模式切换机制**：研究了基于检测结果的双模式智能切换算法，根据连续未检测次数、检测距离等因素自动在本地和云端模式之间切换，平衡实时性和检测精度的需求。

### 2. 三维坐标计算与定位技术

- **深度信息处理**：使用Intel RealSense深度相机获取环境深度信息，研究了深度图像与RGB图像的对齐、滤波和噪声处理算法，提高深度数据的准确性。

- **非线性距离估计算法**：针对云端检测无法直接获取深度信息的问题，提出了基于边界框大小的非线性映射算法，通过建立边界框面积与物理距离之间的映射关系，实现了准确的距离估计。

- **多坐标系转换**：研究了相机坐标系到机械臂坐标系的精确转换方法，通过旋转矩阵和偏移量的计算，实现了乒乓球位置的准确映射，为精确抓取提供了坐标基础。

### 3. 智能控制与避障系统

- **自动逼近算法**：开发了基于视觉反馈的自动逼近控制系统，通过持续的位置检测和调整，实现机器人向目标乒乓球的精确逼近。

- **避障决策系统**：研究了障碍物检测、威胁评估和避障决策的完整流程，基于障碍物的大小、距离和移动方向计算威胁等级，并在威胁等级超过安全阈值时触发避障动作。

- **机械臂控制策略**：开发了机械臂的精确控制算法，包括安全检查、路径规划和抓取动作序列，确保乒乓球能够被稳定抓取并放置到指定位置。

### 4. 系统集成与性能优化

- **系统架构设计**：采用模块化设计理念，将系统划分为视觉处理、控制器、硬件接口等多个功能模块，实现了各模块之间的高效协作。

- **实时性能优化**：针对系统实时性要求，研究了图像处理加速、模型优化和资源调度策略，确保系统在实际应用中的流畅运行。

- **可靠性保障机制**：设计了冷却机制、重试机制和错误处理策略，提高系统在复杂环境下的稳定性和可靠性。

## 三、关键技术

### 1. YOLO目标检测技术

采用YOLO（You Only Look Once）目标检测算法作为本地实时检测的核心技术。YOLO是一种单阶段目标检测算法，能够在一次前向传播中同时预测多个目标的位置和类别，具有速度快、精度高的特点。本项目使用TensorRT优化的YOLO模型（`table_tennis.engine`），在GPU加速下实现约30FPS的检测帧率，检测延迟仅为33ms/帧，满足实时性要求。

### 2. 云端大模型视觉增强技术

针对远距离检测问题，创新性地引入云端大模型视觉增强技术。系统使用Ark API接口，调用豆包视觉大模型（doubao-seed-1-6-250615）进行远距离乒乓球检测。该模型具有更强的视觉理解能力和远距离目标检测能力，能够在本地模型性能下降的远距离场景下提供高质量的检测结果。

### 3. 深度相机与三维重建技术

使用Intel RealSense深度相机获取环境的深度信息，结合RGB图像实现三维场景重建。系统通过`rs.align`技术将深度图像与RGB图像进行精确对齐，然后使用`rs2_deproject_pixel_to_point`函数将像素坐标转换为相机坐标系下的三维坐标，为后续的定位和控制提供准确的空间信息。

### 4. 非线性距离估计算法

针对云端检测无法直接获取深度信息的问题，提出了基于边界框大小的非线性映射算法。该算法通过建立边界框面积与物理距离之间的非线性映射关系：

```
Distance = a * (1 / (bbox_size + b))^c
```

其中a、b、c为根据实验数据拟合得到的系数。通过该算法，系统能够基于边界框大小准确估算乒乓球与机器人的物理距离，为远距离目标的定位和逼近提供依据。

### 5. 双模式智能切换技术

设计了基于检测结果的双模式智能切换机制，根据连续未检测次数、检测距离等因素自动在本地和云端模式之间切换。当连续5次未检测到乒乓球时，系统自动切换到云端识别模式；一旦检测到乒乓球，立即切换回本地识别模式。同时，在云端模式下自动调整移动时间参数，确保车辆移动更加稳定，避免因识别延迟导致的过冲。

### 6. 基于威胁等级的智能避障算法

开发了基于威胁等级的智能避障算法，通过障碍物检测单元检测路径上的障碍物，然后由威胁评估单元根据障碍物的大小、距离和移动方向计算威胁等级。当威胁等级超过预设阈值（0.5）时，触发避障决策单元生成避障指令，控制机器人停止当前移动方向，向与障碍物垂直的方向移动预设距离，然后重新规划路径继续向目标乒乓球移动。

### 7. 视觉反馈控制技术

实现了基于视觉反馈的闭环控制系统，通过持续的视觉检测和位置计算，实时调整机器人的移动方向和速度。系统能够根据乒乓球在图像中的位置偏差，计算出相应的移动参数，实现精确的位置调整和逼近。同时，通过容差范围的动态调整（近距离时使用更小的容差），进一步提高了控制精度。

通过以上关键技术的综合应用，本项目开发的乒乓球智能捡取系统在检测精度、环境适应性、智能化程度等方面均取得了显著进展，为解决传统捡球设备存在的问题提供了有效的技术方案。